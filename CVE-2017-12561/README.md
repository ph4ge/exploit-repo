# CVE-2018-6231 
* Title: Trend Micro Smart Protection Server Auth Command Injection Authentication Bypass Vulnerability 
* CVE-ID: CVE-2017-12561 
* Affected Product: Intelligent Management Center (iMC) 
* Description: The specific flaw exists within dbman service, which listens on TCP port 2810 by default. A crafted opcode 10012 message can cause a pointer to be reused after it has been freed. An attacker can leverage this vulnerability to execute code under the context of SYSTEM. 

---- 
The exact version of the vulnerable software is `iMC_PLAT_7.3_E0504` which there
is a critical patch for it `iMC_PLAT_7.3_E0504P04`. After downloading the whole
package and installing the solution on a Windows 7 SP1 (I didn't have a later
version of Windows or Windows Server to test it as described). 

Following the installation guideline provided by the vendor [here](), I could
successfully configure the Microsoft SQL Server on the Windows 7. By looking at
the binaries installed on the installation path, I could find dbman at
`C:\Progra~1\iMC\dbman\bin` path. 

To make sure the critical patch will affect the `dbman`, I took a backup of the
file to compare the `md5sum` of before/after patch version. 

```
dbman.exe.orig : c0a5cd15339a8eda718886510a347ce8
dbman.exe.patc : 3cd632d4245d08e76014e7240e5f5f82
``` 

## Diffing Process 
Here I used Diaphora for binary patching. In the following, we can see an
initial view of functions changed between these two release. 

![initial view of diaphora bindiff results of dbman.exe](https://github.com/pwnslinger/exploit-repo/raw/master/src/CVE-2017-12561/pics/initial_view_bindiff.png) 


